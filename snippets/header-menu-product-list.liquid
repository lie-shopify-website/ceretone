{% comment %} 手机端需要根据是否有内容，来阻止是否跳转A链接 {% endcomment %}
{% liquid
    assign allow_redirect = true
    assign has_child = false
%}

{%  capture product_area %}
    {% for i in (1..6) %}
    {% capture product_handle %}product{{ i }}{% endcapture %}
    {% capture product_image %}product_image{{ i }}{% endcapture %}
    {% capture product_image_mb %}product_image_mb{{ i }}{% endcapture %}
    {% capture product_title %}product_title{{ i }}{% endcapture %}
    {% capture product_tip %}product_tip{{ i }}{% endcapture %}
    {% capture product_tip_color %}product_tip_color{{ i }}{% endcapture %}
    
    {% if block.settings[product_handle] != blank %}
        {% assign allow_redirect = false %}
        {% assign has_child = true %}
        
        <div class="mm-item__product-item">
            <a href="{{ block.settings[product_handle].url }}">
                <div class="product-image">
                    {% if first_inx %} {% comment %} 按需加载 {% endcomment %}
                        <picture>
                            <source srcset="{{ block.settings[product_image_mb] | image_url: width: 768 }}"  media="(max-width: 768px)" />
                            <source srcset="{{ block.settings[product_image]  | image_url: width: block.settings.image.width }}" media="(min-width: 769px)" />
                            <img src="{{ block.settings[product_image_mb] | image_url: width: 768 }}" width="100%" height="auto" />
                        </picture>
                    {% else %}
                        <picture>
                            <source data-srcset="{{ block.settings[product_image_mb] | image_url: width: 768 }}"  media="(max-width: 768px)" />
                            <source data-srcset="{{ block.settings[product_image]  | image_url: width: block.settings.image.width }}" media="(min-width: 769px)" />
                            <img data-src="{{ block.settings[product_image_mb] | image_url: width: 768 }}" width="100%" height="auto" />
                        </picture>
                    {% endif %}
                </div>
                <div class="pro-info">
                    {% if block.settings[product_tip] != black %}<div class="product-tip" style="color:{{ block.settings[product_tip_color] }};">{{ block.settings[product_tip] }}</div>{% endif %}
                    <div class="product-title">{{ block.settings[product_title] }}</div>
                    <div class="product-price-box">
                        <div class="p-price">{{ block.settings[product_handle].price | money }}</div>
                        {% if block.settings[product_handle].price < block.settings[product_handle].compare_at_price %}
                        <div class="p-price-at">{{ block.settings[product_handle].compare_at_price | money }}</div>
                        {% endif %}
                    </div>
                </div>
            </a>
        </div>
    {% endif %}
{% endfor %}
{% endcapture %}

<div class="mega-menu-item item-line-pd type_product_list {% if first_inx %}active {% endif %} js-expand-parent js-expand-single">
    <div class="mb header-item js-expand-header {% if allow_redirect %} js_allow_redirect{% endif %}">
        {% if block.settings.block_url != blank %}<a href="{{ block.settings.block_url }}">{% endif %}
            <span class="th-title">{{ block.settings.block_text }}</span>
            {% if block.settings.block_icon != blank %}<div class="block-icon"><img src="{{ block.settings.block_icon | image_url:width:50 }}" width="50" height="50" /></div>{% endif %}
        {% if block.settings.block_url != blank %}</a>{% endif %}
        {% if has_child %}
            <svg version="1.1" class="child-arrow mb" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 66.91 122.88" style="enable-background:new 0 0 66.91 122.88" xml:space="preserve"><g><path d="M1.95,111.2c-2.65,2.72-2.59,7.08,0.14,9.73c2.72,2.65,7.08,2.59,9.73-0.14L64.94,66l-4.93-4.79l4.95,4.8 c2.65-2.74,2.59-7.11-0.15-9.76c-0.08-0.08-0.16-0.15-0.24-0.22L11.81,2.09c-2.65-2.73-7-2.79-9.73-0.14 C-0.64,4.6-0.7,8.95,1.95,11.68l48.46,49.55L1.95,111.2L1.95,111.2L1.95,111.2z" fill="#777777"></path></g></svg>
        {% endif %}
    </div>
    <div class="js-expand-content">
        <div class="js-expand-content-overflow js-scroll-container">
            <div class="mm-item_main-layout">
            <div class="mm-item_main js-scroll-content">
                <div class="mm-item__product-area">
                    {{ product_area }}
                </div>
            </div>
            </div>
        </div>
    </div>
</div>