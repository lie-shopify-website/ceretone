
{% schema %}
    {
        "name": "Sticky Addtocart Btn",
        "settings": [
            { "type": "product", "id": "custom_product", "label": "产品" },
            { "type": "text", "id": "custom_class", "label": "自定义class" },
            { "type": "color", "id": "section_bg_color", "label": "模块背景", "default": "#fff" },
            { "type": "color", "id": "bg_color", "label": "按钮背景", "default": "#000000" },
            { "type": "color", "id": "color", "label": "按钮文字颜色", "default": "#ffffff" },
            { "type": "liquid", "id": "btn_label", "label": "按钮名称" },
            { "type": "range", "id": "btn_max_width", "label": "按钮宽度", "min": 5, "max": 500, "step": 5, "unit": "px", "default": 240 },
            { "type": "range", "id": "btn_max_width_mb", "label": "按钮宽度(手机端)", "min": 5, "max": 500, "step": 5, "unit": "px", "default": 240 },
            { "type": "liquid", "id": "liquid", "label": "附加内容(选填)" },
        ],
        "presets": [
            {
                "name": "Sticky Addtocart Btn",
                "category": "Custom"
            }
        ]
    }
{% endschema %}

<style>
[data-section-id="{{ section.id }}"] {
    --sb-bg_color: {{ section.settings.bg_color }};
    --sb-font_color: {{ section.settings.color }};
    --section_bg_color:{{ section.settings.section_bg_color }};
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    text-align: center;
    z-index:1000;
    background: var(--section_bg_color);
    padding:10px 0;
}
[data-section-id="{{ section.id }}"] .addtocart_btn {
    width: 100%;
    display: flex;
    max-width: {{ section.settings.btn_max_width }}px;
    background: var(--sb-bg_color);
    color: var(--sb-font_color);
    text-decoration: none;
    justify-content: center;
    align-items: center;
    min-height: 50px;
    margin: auto;
    border-radius: 10px;
}
@media screen and (max-width: 767px) {
    [data-section-id="{{ section.id }}"] {
        bottom: 0;
        padding:10px 0;
    }
    [data-section-id="{{ section.id }}"] .addtocart_btn {
        max-width:  {{ section.settings.btn_max_width_mb }}px;
    }
}
</style>

<div class="sticky-btn {{ section.settings.custom_class }}" data-section-id="{{ section.id }}">

    {%- assign curr_product = section.settings.custom_product -%}
    {%- assign product_form_id = 'addtocart-'
        | append: section.id
        | append: curr_product.id
    -%}
    <product-form class="card__add-to-cart">
        {%- form 'product',
            curr_product,
            id: product_form_id,
            class: 'form',
            novalidate: 'novalidate',
            data-type: 'add-to-cart-form'
        -%}

            {% if curr_product.has_only_default_variant %}
                <input
                    type="hidden"
                    name="id"
                    value="{{ curr_product.selected_or_first_available_variant.id }}"
                >
                {% else %}
                    <select name="id" class="as-form-quantity" >
                    {% for variant in curr_product.variants %}
                        <option
                        class="as-variant-option"
                        value="{{ variant.id }}"
                        {% if variant.available == false %}
                            disabled="disabled"
                        {% endif %}
                        {% if variant.available == true %}
                            name="optional"
                        {% endif %}
                        {% if variant == curr_product.first_available_variant %}
                            selected
                        {% endif %}
                        >
                        {{ variant.title }}
                        </option>
                    {% endfor %}
                    </select>
            {% endif %}
            
            <button type="submit" class="addtocart_btn button" name="add" form="{{ product_form_id }}" >
                <span class="btn-text">
                    {{ section.settings.btn_label | default:'Buy Now' }}
                </span>
                <div class="loading-overlay__spinner hidden">
                    <svg
                        aria-hidden="true"
                        focusable="false"
                        role="presentation"
                        class="spinner"
                        viewBox="0 0 66 66"
                        xmlns="http://www.w3.org/2000/svg"
                    >
                        <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
                    </svg>
                </div>
            </button>
        {%- endform -%}
    </product-form>

        
</div>
{{ section.settings.liquid }}
<script>
    ;(function() {
        const oSection = document.querySelector('[data-section-id="{{ section.id }}"]');

        window.addEventListener('DOMContentLoaded', () => {
            const currentUrl = window.location.href;
            if(currentUrl.indexOf('aaa') != -1){
                oSection.style.display = 'block';
            }
        });

    })();
</script>

