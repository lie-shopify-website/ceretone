
{% schema %}
  {
    "name": "Image video with text",
    "settings": [
        { "type": "text", "id": "custom_cls", "label": "自定义类名" },
        { "type": "color", "id": "background", "label": "Background", "default":"#ffffff" },
        { "type": "color", "id": "background_mb", "label": "Background 手机端", "default":"#ffffff" },
        { "type": "select", "id": "section_layout", "options": [
            { "value": "textimage", "label": "左文右图" },
            { "value": "imagetext", "label": "左图右文" }
          ],
          "default": "textimage", "label": "布局"
        },
        {
          "type": "checkbox",
          "id": "mobile_section_layout",
          "default": false,
          "label": "电脑端使用手机端的布局，上下结构。（勾选这个值，上面的左右结构不起作用）"
        },
        { "type": "header","content":"标题"},
        { "type": "liquid", "id": "title", "label": "大标题" },
        { "type": "liquid", "id": "sub_title", "label": "小标题" },

        { "type": "header","content":"图片和视频(视频优先)"},
        { "type": "video", "id":"video", "label":"视频"},
        { "type": "image_picker", "id":"image", "label":"图片"},
        { "type": "image_picker", "id":"image_mb", "label":"图片(手机端)"},
        { "type": "range", "id": "image_percent", "label": "图片区域占比(电脑端)", "min": 0, "max": 100, "step": 1, "unit": "%", "default": 50 },

        { "type": "header","content":"PC"},
        { "type": "range", "id": "pc_padding_top", "label": "Top Space", "min": 0, "max": 150, "step": 2, "unit": "px", "default": 0 },
        { "type": "range", "id": "pc_padding_bottom", "label": "Bottom Space", "min": 0, "max": 150, "step": 2, "unit": "px", "default": 0 },
        { "type": "header","content":"Mobile"},
        { "type": "range", "id": "mb_padding_top", "label": "Top Space", "min": 0, "max": 200, "step": 2, "unit": "px", "default": 0 },
        { "type": "range", "id": "mb_padding_bottom", "label": "Bottom Space", "min": 0, "max": 200, "step": 2, "unit": "px", "default": 0 }
        
    ],
    "blocks": [
        {
            "type": "overline",
            "name": "Overline",
            "settings": [
                { "type": "textarea", "id": "overline", "default": "Overline", "label": "Overline" }
            ]
        },
        {
            "type": "heading",
            "name": "Heading",
            "settings": [
                { "type": "textarea", "id": "heading", "default": "Image with text", "label": "Heading" }
            ]
        },
        {
            "type": "text",
            "name": "Text",
            "settings": [
                { "type": "richtext", "id": "text", "label": "Text", "default": "<p>Pair text with an image to focus on your chosen product, collection, or blog post. Add details on availability, style, or even provide a review.</p>" }
            ]
        },
        {
            "type": "button",
            "name": "Button",
            "settings": [
                { "type": "text", "id": "button_label", "default": "Button label", "label": "Button label" },
                { "type": "url", "id": "button_link", "label": "Button link" }
            ]
        },
        {
            "type": "liquid",
            "name": "Liquid",
            "settings": [
                { "type": "liquid", "id": "liquid", "label": "Liquid" }
            ]
        },
        {
            "type": "@app"
        }
    ],
    "presets": [
        {
        "name": "Image video with text",
        "category": "Custom"
        }
    ]
  }
{% endschema %}

<style>  
    [data-section-id="{{ section.id }}"] {
        padding-top:{{ section.settings.pc_padding_top }}px;
        padding-bottom:{{ section.settings.pc_padding_bottom }}px;
        background:{{ section.settings.background }};

        --image_percent_pc:{{ section.settings.image_percent }}%;
    }
    @media screen and (max-width: 989px) { 
        [data-section-id="{{ section.id }}"] {
            padding-top:{{ section.settings.mb_padding_top }}px;
            padding-bottom:{{ section.settings.mb_padding_bottom }}px;
            background:{{ section.settings.background_mb }};
        }
    }

    
    .image-with-text-ly img,
    .image-with-text-ly video {
        max-width: 100%;
        display: block;
        border-radius: 10px;
    }

    .image-with-text-ly .heading-box {
        margin-bottom: 24px;
        text-align: center;
    }
    .image-with-text-ly h2.heading-title.h3 {
        margin-bottom: 0;
    }
    .image-with-text-ly .sub_title {
        margin-top: 10px;
    }

    .image-with-text-ly .itext-inner {
        --itext-gap:30px;
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: space-between;
        gap:var(--itext-gap);
    }

    .image-with-text-ly .itext-picture,
    .image-with-text-ly .itext-content {
        flex:0 0 100%;
    }

    .image-with-text-ly p.itext-context_overline {
        margin-top: 0;
    }
    .image-with-text-ly .itext-context_button a.btn {
        text-decoration: none;
        display: inline-flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
        padding: 8px 20px;
        font-size: 16px;
        border-radius: 10px;
        margin-top:30px;
    }
    .image-with-text-ly .itext-context_button a.btn img {
        width:20px;
    }

    @media screen and (min-width: 990px) { 
        .image-with-text-ly .itext-inner[textimage] {
            flex-direction: row-reverse;
        }
        .image-with-text-ly .itext-picture {
            flex:0 0 calc(var(--image_percent_pc) - var(--itext-gap) / 2);
            max-width:calc(var(--image_percent_pc) - var(--itext-gap) / 2);
        }
        .image-with-text-ly .itext-content {
            flex:0 0 calc(calc(100% - var(--image_percent_pc)) - var(--itext-gap) / 2);
            max-width:calc(calc(100% - var(--image_percent_pc)) - var(--itext-gap) / 2);
        }

        .image-with-text-ly .itext-inner[mobile_section_layout] {
            flex-direction: row !important;
            justify-content: center;
        }
        .image-with-text-ly .itext-inner[mobile_section_layout] .itext-picture{
            flex:0 0 var(--image_percent_pc) !important;
            max-width:var(--image_percent_pc)!important;
        }
        .image-with-text-ly .itext-inner[mobile_section_layout] .itext-content {
            flex:0 0 var(--image_percent_pc)!important;
            max-width:var(--image_percent_pc) !important;
            text-align:center;
        }

        .image-with-text-ly .heading-box {
            margin-bottom: 56px;
        }
        .image-with-text-ly .itext-content {
            padding: 0 30px;
        }
        .image-with-text-ly .itext-context_button a.btn {
            margin-top:50px;
        }
    }
</style>
<div class="image-with-text-ly {{ section.settings.custom_cls }}" data-section-id="{{ section.id }}" style="display:block;">
    <div class="container">
        {% if section.settings.title != blank %}
        <div class="heading-box">
            <h2 class="heading-title h3">{{ section.settings.title }}</h2>
            {% if section.settings.sub_title != blank %}
            <div class="sub_title body-large">{{ section.settings.sub_title }}</div>
            {% endif %}
        </div>
        {% endif %}
        {{ section.settings.top_liquid }}

        <div class="itext-ly">
            <div class="itext-inner" {{ section.settings.section_layout }} {% if section.settings.mobile_section_layout %}mobile_section_layout{% endif %}>
                <div class="itext-picture" >
                    <div class="picture_box">
                        {% if section.settings.video != blank %}
                            {%liquid
                                assign video = section.settings.video
                                if video.sources[1].url != blank 
                                    assign video_url = video.sources[1].url
                                else
                                    assign video_url = video.sources[0].url
                                endif
                            %}
                            <video playsinline="true" autoplay="autoplay" loop="loop" preload="metadata" muted="muted" controls="controls" class="video-position" poster="{{ video.preview_image | image_url:width:video.preview_image.width }}">
							    <source data-src="{{ video_url }}" type="video/mp4" />
                            </video>
                        {% else %}
                            <picture>
                                <source srcset="{{ section.settings.image_mb | image_url: width: 989 }}"  media="(max-width: 989px)" />
                                <source srcset="{{ section.settings.image | image_url: width: section.settings.image.width }}" media="(min-width: 990px)" />
                                <img src="{{ section.settings.image_mb | image_url: width: 989 }}" width="100%" height="auto" />
                            </picture>
                        {% endif %}
                    </div>
                </div>
                <div class="itext-content">
                {%- for block in section.blocks -%}
                {%- case block.type -%}

                    {%- when '@app' -%}
                        {% render block %}

                    {%- when 'overline' -%}
                        {%- if block.settings.overline != blank -%}
                            <p class="itext-context_overline body-large">{{ block.settings.overline }}</p>
                        {%- endif -%}

                    {%- when 'heading' -%}
                        {%- if block.settings.heading != empty -%}
                            <h2 class="itext-context_heading h3 title">{{ block.settings.heading }}</h2>
                        {%- endif -%}

                    {%- when 'text' -%}
                        {%- if block.settings.text != blank -%}
                        <div class="itext-context_text richtext-with-link body-large">
                            {{ block.settings.text }}
                        </div>
                        {%- endif -%}

                    {%- when 'liquid' -%}
                        {%- if block.settings.liquid != blank -%}
                            <div class="itext-context_liquid">
                                {{ block.settings.liquid }}
                            </div>
                        {%- endif -%}

                    {%- when 'button' -%}
                        {%- if block.settings.button_label != blank -%}
                        <div class="itext-context_button">
                            <a href="{{ block.settings.button_link }}" class="btn button button--primary">
                                {{ block.settings.button_label }}
                            </a>
                        </div> 
                        {%- endif -%}
                {%- endcase -%}
                {%- endfor -%}

                </div>
            </div>
        </div>
    </div>
</div>
<script>
    ;(function() {
        const oSection = document.querySelector('[data-section-id="{{ section.id }}"]');

        window.addEventListener('DOMContentLoaded', () => {

            var videos = oSection.querySelectorAll('video.video-position');
            videos.forEach(function(video) {
                if(! video) return; 

                let videoSource = video.querySelector('source');
                if(!videoSource.src){
                    videoSource.src = videoSource.getAttribute('data-src');
                    video.load();    /* 生效 */
                }else{
                    video.play();    /* 播放 */
                }
            });
        });

    })();
</script>
